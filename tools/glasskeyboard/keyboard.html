<html>
<head>
  <title>Glass Keyboard</title>
    <link rel="stylesheet" href="lib/jquery-ui.css" />
    <script src="lib/jquery.min.js"></script>
    <script src="lib/jquery-ui.js"></script>
    <script>
    port = 8881;
    baseURL = "http://localhost:" + port + "/";
    adbURL = baseURL + "cmd/";
    showClickTimeout = 150;
    keyBindings = {
      13: 'TAP',
      37: 'LEFT',
      39: 'RIGHT',
      40: 'DOWN',
      72: 'HOME',
      71: 'GLASS_SETTINGS', /* G */
      76: 'LAUNCHY', /* L */
      87: 'WEARSCRIPT_LAUNCHY' /* W */
    };

    function adb(name) {
      console.log("adb function: " + name);
      $.ajax(adbURL + name);
    }

    function showClick(name) {
      var el = $('#'+name);
      el.focus();
      setTimeout( function() {el.blur()}, showClickTimeout);
    }

    function doTouchEvent(name) {
      adb(name);
      showClick(name);
    }

    $(function() {
      $('#buttonContainer').width(500);
      // add elements for action bindings
      var boundActions = [];
      for (k in keyBindings) boundActions.push(keyBindings[k]);
      var bc = $('#buttonContainer');
      $.each(boundActions, function(index, value) {
        bc.append($('<button>').html(value).addClass('touchInput').attr('id', value));
      });

      // bind adb commands
      $(".touchInput").button().click(function(event) {
        adb($(event.currentTarget).attr('id'));
        $(event.currentTarget).blur(); // get rid of residual focus border
      });

      // bind key events
      $(document).keydown(function( event ) {
        console.log("Key event " + event.which);
        if (keyBindings.hasOwnProperty(event.which)) {
          doTouchEvent(keyBindings[event.which]);
        } else {
          console.log("Unassigned keyy event.");
        }
      });

      // initialize connected status
      $.ajax(baseURL + 'isConnected')
        .done(function(data) {
          $('#isConnected').html((data == "True") ? "Device connected." : "Device not connected.");
        })
        .fail(function() {console.log("Failed to get isConnected.")});

      // initialize root status
      $.ajax(baseURL + 'isRoot')
        .done(function(data) {
          $('#isRoot').html((data == "True") ? "Running as root." : "Not running as root.");
        })
        .fail(function() {console.log("Failed to get isRoot.")});


    });

    </script>
</head>

<body>
  <div id='buttonContainer'></div>
  <div id='isConnected'>Unknown connection status.</div>
  <div id='isRoot'>Unknown root privileges.</div>
</body>
</html>
